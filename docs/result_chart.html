<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEAR - Result Chart</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Protest+Guerrilla&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
  <style>
    :root {
      --border: #333333;
      --header-salmon: hsl(44, 59%, 61%);
      --sidebar-color: #ffc374;
      --sidebar-shadow: rgb(245, 199, 113);
      --text-dark: #fa5a2a;
      --sidebar-width: 260px;
      --scale: 1;
      --color-01pm: #ffd2c0;
      --color-06pm: #b7f7c7a9;
      --color-08pm: #faf6bf;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f7f9;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    /* --- Sidebar & Menu --- */
    .sidebar {
      position: fixed;
      left: 15px;
      top: 15px;
      width: var(--sidebar-width);
      background: var(--sidebar-color);
      z-index: 3000;
      padding-top: 50px;
      border-radius: 15px;
      box-shadow: 0 10px 30px var(--sidebar-shadow);
      transform: scale(0);
      transform-origin: top left;
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      pointer-events: none;
      text-align: left;
    }

    .sidebar.active {
      transform: scale(1);
      opacity: 1;
      pointer-events: auto;
    }

    .sidebar a {
      padding: 15px 25px;
      display: block;
      color: #3a3a3a;
      text-decoration: none;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      font-weight: bold;
    }

    .sidebar a:hover {
      background: rgba(255, 255, 255, 0.3);
      padding-left: 35px;
    }

    .menu-icon {
      position: fixed;
      top: 15px;
      left: 15px;
      cursor: pointer;
      z-index: 3100;
      background: white;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      border: 2px solid #ffd700;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* --- Main Content --- */
    .main-content {
      padding-top: 70px;
      width: 100%;
    }

    h1.gradient-text {
      background: linear-gradient(90deg, #ee7342, #1e77eb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-family: "Protest Guerrilla", sans-serif;
      font-size: 2.5rem;
      margin: 10px 0;
    }

    .toolbar {
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    input,
    select,
    .btn-apply {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 5px;
      font-weight: bold;
    }

    .btn-apply {
      background: #e91616;
      color: white;
      cursor: pointer;
      border: none;
    }

    /* --- Table Styling --- */
    .table-outer {
      width: 100%;
      display: flex;
      justify-content: center;
      overflow: hidden;
    }

    .table-inner {
      transform: scale(var(--scale));
      transform-origin: top center;
      padding: 10px;
      /* Space to prevent border clipping in image */
    }

    #captureArea {
      background: white;
      border: 4px solid var(--border);
      /* Thick border for PNG */
      display: inline-block;
      padding: 2px;
    }

    table {
      border-collapse: collapse;
      min-width: 1000px;
    }

    .banner {
      background: #cfb335;
      color: rgb(34, 33, 33);
      font-size: 24px;
      padding: 15px;
      border-bottom: 2px solid var(--border);
      text-transform: uppercase;
      font-weight: 900;
    }

    .col-head-main td {
      background: white;
      color: #ff1212;
      font-weight: 900;
    }

    .time-header {
      background: #dabc59;
      color: rgb(14, 67, 212);
      font-size: 16px;
    }

    .date-col {
      background: var(--header-salmon);
      color: var(--text-dark);
      width: 60px;
      font-size: 18px;
    }

    td,
    th {
      border: 1px solid var(--border);
      padding: 10px 5px;
      text-align: center;
      font-weight: 800;
    }

    .data-cell {
      font-size: 19px;
      color: #000;
      position: relative;
    }

    /* Corner Indicator */
    .data-cell::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      border-top: 8px solid green;
      border-right: 8px solid transparent;
    }

    .col-01pm {
      background-color: var(--color-01pm);
    }

    .col-06pm {
      background-color: var(--color-06pm);
    }

    .col-08pm {
      background-color: var(--color-08pm);
    }

    .btn-download {
      background: #e91616;
      color: white;
      margin: 30px 0;
      padding: 15px 30px;
      width: 90%;
      max-width: 400px;
      border-radius: 30px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(233, 22, 22, 0.4);
    }
  </style>
</head>

<body>

  <div class="menu-icon" onclick="toggleSidebar()"><span>ðŸ“œ</span></div>

  <nav class="sidebar" id="sidebar">
    <div style="text-align: right; padding: 10px;">
      <span onclick="toggleSidebar()" style="cursor:pointer; font-size: 28px;">&times;</span>
    </div>
    <a href="index.html">Home</a>
    <a href="mcchart.html">Machine Chart</a>
    <a href="result_chart.html">Results Chart</a>
    <a href="mc_and_result.html">MC and Result</a>
    <a href="mc.html">MC</a>
    <a href="results.html">Result</a>
  </nav>

  <div class="main-content">
    <h1 class="gradient-text">DEAR - RESULT CHART</h1>

    <div class="toolbar">
      <input type="text" id="tableSearch" placeholder="Search Number..." onkeyup="renderChart()">
      <select id="monthSelect"></select>
      <select id="yearSelect">
        <option value="2026">2026</option>
        <option value="2025">2025</option>
      </select>
      <button class="btn-apply" onclick="renderChart()">Apply Filter</button>
    </div>

    <div class="table-outer" id="tableOuter">
      <div class="table-inner" id="tableInner">
        <div id="captureArea">
          <table id="resultTable">
            <thead>
              <tr>
                <th colspan="11" class="banner" id="tableBanner">Dear Result Number Chart</th>
              </tr>
              <tr class="col-head-main">
                <td style="background: var(--header-salmon);">C</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td style="background: var(--header-salmon);">C</td>
              </tr>
              <tr style="background: var(--header-salmon);">
                <th>Date</th>
                <th class="time-header">10AM</th>
                <th class="time-header">11AM</th>
                <th class="time-header">12PM</th>
                <th class="time-header">01PM</th>
                <th class="time-header">05PM</th>
                <th class="time-header">06PM</th>
                <th class="time-header">07PM</th>
                <th class="time-header">08PM</th>
                <th class="time-header">09PM</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <button class="btn-download" onclick="exportToPNG()">Download PNG Chart</button>
  </div>

  <script>
    const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    const mSel = document.getElementById('monthSelect');
    monthNames.forEach((m, i) => {
      let opt = new Option(m, i + 1);
      if (i === new Date().getMonth()) opt.selected = true;
      mSel.add(opt);
    });

    function applyAutoScale() {
      const inner = document.getElementById('tableInner');
      const outer = document.getElementById('tableOuter');
      const captureArea = document.getElementById('captureArea');

      const availableWidth = window.innerWidth * 0.95;
      const actualWidth = captureArea.offsetWidth + 20;
      let scale = Math.min(1, availableWidth / actualWidth);

      document.documentElement.style.setProperty('--scale', scale);
      outer.style.height = (captureArea.offsetHeight * scale) + 50 + "px";
    }

    function renderChart() {
      const body = document.getElementById('tableBody');
      const banner = document.getElementById('tableBanner');
      const month = parseInt(mSel.value);
      const year = document.getElementById('yearSelect').value;
      const days = new Date(year, month, 0).getDate();
      const searchTerm = document.getElementById('tableSearch').value;

      banner.innerText = `Dear Result Number Chart - ${monthNames[month - 1]} ${year}`;
      body.innerHTML = "";

      for (let d = 1; d <= days; d++) {
        let rowData = [];
        for (let i = 0; i < 9; i++) {
          rowData.push(Math.floor(10000 + Math.random() * 90000).toString());
        }

        // Filter logic
        if (searchTerm && !rowData.some(r => r.includes(searchTerm)) && !d.toString().includes(searchTerm)) continue;

        let rowHtml = `<tr><td class="date-col">${d}</td>`;
        rowData.forEach((val, index) => {
          let extraClass = "";
          if (index === 3) extraClass = "col-01pm";
          if (index === 5) extraClass = "col-06pm";
          if (index === 7) extraClass = "col-08pm";
          rowHtml += `<td class="data-cell ${extraClass}">${val}</td>`;
        });
        rowHtml += `<td class="date-col">${d}</td></tr>`;
        body.innerHTML += rowHtml;
      }
      setTimeout(applyAutoScale, 100);
    }

    async function exportToPNG() {
      const node = document.getElementById('captureArea');
      const btn = document.querySelector('.btn-download');
      btn.innerText = "Capturing...";

      try {
        const dataUrl = await htmlToImage.toPng(node, {
          backgroundColor: '#fff',
          pixelRatio: 2,
          style: { transform: 'scale(1)', transformOrigin: 'top left' }
        });
        const link = document.createElement('a');
        link.download = `Result-Chart-${monthNames[mSel.value - 1]}-${yearSelect.value}.png`;
        link.href = dataUrl;
        link.click();
      } catch (e) {
        alert("Download failed.");
      } finally {
        btn.innerText = "Download PNG Chart";
      }
    }

    window.addEventListener('resize', applyAutoScale);
    renderChart();
  </script>
</body>

</html>