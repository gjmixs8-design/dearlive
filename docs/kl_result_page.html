<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kerala Yearly MC Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Young+Serif&display=swap" rel="stylesheet">
    <style>
        :root {
            --sidebar-maroon: #800000;
            --header-salmon: #f7bf58;
            --main-red: #b22222;
            --border-heavy: #333;
            --scale: 1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0faff;
            margin: 0;
            text-align: center;
            overflow-x: hidden;
        }

        h1 {
            color: var(--sidebar-maroon);
            margin-top: 30px;
            font-size: 22px;
            text-transform: uppercase;
            font-family: "Young Serif", serif;
        }

        .table-outer {
            width: 98vw;
            margin: 20px auto;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        .table-inner {
            transform: scale(var(--scale));
            transform-origin: top center;
            display: inline-block;
        }

        table {
            border-collapse: collapse;
            background: #fff;
            border: 2px solid #000;
            width: 1600px;
            /* Slightly wider to accommodate labels */
        }

        th,
        td {
            border: 1px solid #999;
            padding: 6px 2px;
            font-weight: bold;
            font-size: 11px;
            /* Smaller font to fit labels */
            text-align: center;
        }

        .hdr-main {
            background: #e99d11;
            color: white;
            font-size: 20px;
        }

        .hdr-sub {
            background: #f8d256;
            color: #d32f2f;
        }

        .hdr-labels {
            background: #fff3e0;
            color: #555;
            font-size: 10px;
        }

        .date-col {
            background: #fcbb67;
            width: 50px;
            border-right: 2px solid var(--border-heavy);
        }

        .month-header {
            background: var(--header-salmon);
            color: #000;
            border-right: 2px solid var(--border-heavy);
        }

        .col-right {
            border-right: 2px solid var(--border-heavy);
        }

        .stars {
            color: #d32f2f;
            background: #eee;
        }

        .highlight-red {
            color: #d32f2f;
            background-color: #ffebee;
        }

        .btn-download {
            background: var(--sidebar-maroon);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px;
            transition: 0.3s;
        }

        .btn-download:hover {
            background: #a00000;
        }
    </style>
</head>

<body>

    <h1>Kerala Yearly Result Chart (2025 - 26)</h1>

    <div class="table-outer" id="tableOuter">
        <div class="table-inner" id="tableInner">
            <table id="targetTable">
                <thead>
                    <tr class="hdr-main">
                        <th colspan="25">Kerala Yearly Result Chart (2025 - 26)</th>
                    </tr>
                    <tr class="hdr-sub">
                        <th class="date-col" rowspan="2">DATE</th>
                        <th colspan="2" class="month-header">FEB</th>
                        <th colspan="2" class="month-header">MAR</th>
                        <th colspan="2" class="month-header">APR</th>
                        <th colspan="2" class="month-header">MAY</th>
                        <th colspan="2" class="month-header">JUN</th>
                        <th colspan="2" class="month-header">JUL</th>
                        <th colspan="2" class="month-header">AUG</th>
                        <th colspan="2" class="month-header">SEP</th>
                        <th colspan="2" class="month-header">OCT</th>
                        <th colspan="2" class="month-header">NOV</th>
                        <th colspan="2" class="month-header">DEC</th>
                        <th colspan="2" class="month-header">JAN</th>
                    </tr>
                    <tr class="hdr-labels">
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                        <th>MACHINE</th>
                        <th class="col-right">RESULT</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <button class="btn-download" id="dlBtn" onclick="downloadTable()">Download Chart</button>

    <script>
        // 1. Generate Data (6-Digit Numbers)
        function generateTableData() {
            const body = document.getElementById('tableBody');
            let html = '';

            for (let d = 1; d <= 31; d++) {
                html += `<tr><td class="date-col">${d}</td>`;
                for (let m = 0; m < 12; m++) {
                    const isFebEnd = (d > 28 && m === 0);
                    const isShortMonthEnd = (d > 30 && [2, 4, 7, 9].includes(m));

                    if (isFebEnd || isShortMonthEnd) {
                        html += `<td class="stars">***</td><td class="col-right stars">***</td>`;
                    } else {
                        let val1 = Math.floor(100000 + Math.random() * 900000);
                        let val2 = Math.floor(100000 + Math.random() * 900000);
                        let cls = (d % 5 === 0) ? 'highlight-red' : '';
                        html += `<td class="${cls}">${val1}</td><td class="col-right ${cls}">${val2}</td>`;
                    }
                }
                html += `</tr>`;
            }
            body.innerHTML = html;
        }

        // 2. Mobile Responsive Scaling
        function applyAutoScale() {
            const inner = document.getElementById('tableInner');
            const outer = document.getElementById('tableOuter');
            const table = document.getElementById('targetTable');

            const availableWidth = window.innerWidth * 0.98;
            const actualWidth = 1600;
            const scale = availableWidth / actualWidth;

            if (scale < 1) {
                document.documentElement.style.setProperty('--scale', scale);
                outer.style.height = (table.offsetHeight * scale) + "px";
            } else {
                document.documentElement.style.setProperty('--scale', '1');
                outer.style.height = "auto";
            }
        }

        // 3. PNG Export
        async function downloadTable() {
            const btn = document.getElementById('dlBtn');
            const node = document.getElementById('targetTable');
            btn.innerText = "Processing...";

            try {
                const dataUrl = await htmlToImage.toPng(node, {
                    backgroundColor: '#fff',
                    style: { transform: 'scale(1)' }
                });
                const link = document.createElement('a');
                link.download = 'Kerala-Yearly-Chart.png';
                link.href = dataUrl;
                link.click();
            } catch (error) {
                alert("Download failed. Please try again.");
            } finally {
                btn.innerText = "Download Chart";
            }
        }

        // Initialize
        window.addEventListener('resize', applyAutoScale);
        window.addEventListener('load', () => {
            generateTableData();
            applyAutoScale();
        });
    </script>
</body>

</html>