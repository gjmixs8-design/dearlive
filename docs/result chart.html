<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DEAR - Result Chart</title>
  <style>
    :root {
      --border: #333333;
      --header-salmon: #e9d87a;
      --sidebar-maroon: #e91616;
      --text-dark: #e72828;
      --sidebar-width: 260px;
      --scale: 1;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f7f9;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    /* --- Sidebar (Maroon Style) --- */
    .sidebar {
      position: fixed;
      left: calc(-1 * var(--sidebar-width));
      top: 0;
      height: 100%;
      width: var(--sidebar-width);
      background: var(--sidebar-maroon);
      color: white;
      transition: 0.3s ease;
      z-index: 3000;
      padding-top: 60px;
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar a {
      padding: 15px 25px;
      display: block;
      color: white;
      text-decoration: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-weight: bold;
    }

    .menu-icon {
      position: fixed;
      top: 15px;
      left: 15px;
      cursor: pointer;
      z-index: 3100;
      background: white;
      padding: 8px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .menu-icon div {
      width: 25px;
      height: 3px;
      background: var(--sidebar-maroon);
      margin: 5px 0;
    }

    /* --- Header & Toolbar --- */
    .main-content {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 70px;
    }

    h1 {
      color: var(--text-dark);
      margin-bottom: 10px;
      font-size: 1.5rem;
      text-transform: uppercase;
      font-weight: 800;
    }

    .toolbar {
      margin-bottom: 20px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    input,
    select,
    .btn-apply {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 5px;
      font-weight: bold;
    }

    .btn-apply {
      background: var(--sidebar-maroon);
      color: white;
      cursor: pointer;
      border: none;
    }

    /* --- Scaling System --- */
    .table-outer {
      width: 100vw;
      display: flex;
      justify-content: center;
      overflow: hidden;
    }

    .table-inner {
      transform: scale(var(--scale));
      transform-origin: top center;
      display: inline-block;
    }

    #captureArea {
      background: white;
      border: 3px solid var(--border);
      display: inline-block;
    }

    table {
      border-collapse: collapse;
      min-width: 1000px;
    }

    /* --- Table Styling --- */
    .banner {
      background: #ffdd43;
      /* Green Banner */
      color: rgb(233, 27, 27);
      font-size: 24px;
      padding: 15px;
      text-align: center;
      border: 1px solid var(--border);
    }

    .col-head-main {
      background: white;
      color: #ff1212;
      font-weight: 900;
    }

    .time-header {
      background: #dabc59;
      /* Green Time Slot */
      color: rgb(231, 11, 11);
      font-size: 16px;
    }

    .date-col {
      background: var(--header-salmon);
      color: var(--text-dark);
      width: 130px;
      font-size: 16px;
    }

    td,
    th {
      border: 1px solid var(--border);
      padding: 10px 5px;
      text-align: center;
      font-weight: 800;
    }

    .data-cell {
      font-size: 19px;
      color: #000;
      position: relative;
    }

    /* The Green Corner from your code */
    .data-cell::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      border-top: 8px solid green;
      border-right: 8px solid transparent;
    }

    .btn-download {
      background: var(--sidebar-maroon);
      color: white;
      margin: 20px 0;
      padding: 15px 30px;
      width: 90%;
      max-width: 400px;
      border-radius: 30px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <div class="menu-icon" onclick="toggleSidebar()">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <nav class="sidebar" id="sidebar">
    <div style="text-align: right; padding: 10px;">
      <span onclick="toggleSidebar()" style="cursor:pointer; font-size: 24px;">Ã—</span>
    </div>
    <a href="index.html">Home</a>
    <a href="mcchart.html">Machine Chart</a>
    <a href="result chart.html">Results Chart</a>
    <a href="mc.html">MC</a>
    <a href="results.html">Result</a>
    <a href="mc and result.html">MC and Result</a>
  </nav>

  <div class="main-content">
    <h1>DEAR - RESULT CHART</h1>

    <div class="toolbar">
      <input type="text" id="tableSearch" placeholder="Search Number...">
      <select id="monthSelect"></select>
      <select id="yearSelect">
        <option value="2026">2026</option>
        <option value="2025">2025</option>
      </select>
      <button class="btn-apply" onclick="renderChart()">Apply Filter</button>
    </div>

    <div class="table-outer" id="tableOuter">
      <div class="table-inner" id="tableInner">
        <div id="captureArea">
          <table id="resultTable">
            <thead>
              <tr>
                <th colspan="11" class="banner">Dear Result Number Chart</th>
              </tr>
              <tr class="col-head-main">
                <td style="background: var(--header-salmon);">C</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td>DEAR</td>
                <td style="background: var(--header-salmon);">C</td>
              </tr>
              <tr style="background: var(--header-salmon);">
                <th>Date</th>
                <th class="time-header">10AM</th>
                <th class="time-header">11AM</th>
                <th class="time-header">12PM</th>
                <th class="time-header">01PM</th>
                <th class="time-header">05PM</th>
                <th class="time-header">06PM</th>
                <th class="time-header">07PM</th>
                <th class="time-header">08PM</th>
                <th class="time-header">09PM</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <button class="btn-download" onclick="exportToPNG()">Download PNG Chart</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
  <script>
    const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }

    // Initialize Month Select
    const mSel = document.getElementById('monthSelect');
    monthNames.forEach((m, i) => {
      let opt = new Option(m, i + 1);
      if (i === new Date().getMonth()) opt.selected = true;
      mSel.add(opt);
    });

    function applyAutoScale() {
      const inner = document.getElementById('tableInner');
      const outer = document.getElementById('tableOuter');
      const captureArea = document.getElementById('captureArea');

      const availableWidth = window.innerWidth - 20;
      const actualWidth = captureArea.offsetWidth;
      let scale = Math.min(1, availableWidth / actualWidth);

      document.documentElement.style.setProperty('--scale', scale);
      outer.style.height = (captureArea.offsetHeight * scale) + "px";
    }

    function renderChart() {
      const body = document.getElementById('tableBody');
      const month = parseInt(mSel.value);
      const year = document.getElementById('yearSelect').value;
      const days = new Date(year, month, 0).getDate();
      const searchTerm = document.getElementById('tableSearch').value;

      body.innerHTML = "";

      for (let d = 1; d <= days; d++) {
        const dateStr = `${d.toString().padStart(2, '0')}/${month.toString().padStart(2, '0')}/${year.substring(2)}`;

        let rowHtml = `<tr><td class="date-col">${dateStr}</td>`;

        let rowData = [];
        for (let i = 0; i < 9; i++) {
          // Generate Dummy 5-digit result
          const val = Math.floor(10000 + Math.random() * 90000).toString();
          rowData.push(val);
        }

        // Search filtering logic
        if (searchTerm && !rowData.some(r => r.includes(searchTerm)) && !dateStr.includes(searchTerm)) continue;

        rowData.forEach(val => {
          rowHtml += `<td class="data-cell">${val}</td>`;
        });

        rowHtml += `<td class="date-col">${dateStr}</td></tr>`;
        body.innerHTML += rowHtml;
      }

      setTimeout(applyAutoScale, 50);
    }

    async function exportToPNG() {
      const node = document.getElementById('captureArea');
      try {
        const dataUrl = await htmlToImage.toPng(node, {
          backgroundColor: '#fff',
          pixelRatio: 2,
          style: { transform: 'scale(1)' }
        });
        const link = document.createElement('a');
        link.download = `Result-Chart-${monthNames[mSel.value - 1]}.png`;
        link.href = dataUrl;
        link.click();
      } catch (e) { alert("Export failed"); }
    }

    window.addEventListener('resize', applyAutoScale);
    renderChart(); // Initial Load
  </script>
</body>

</html>